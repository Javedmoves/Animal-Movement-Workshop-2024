# Author: Javed Riaz
############################################################################################################################################################################################################################################################################################
############################################################################################################################################################################################################################################################################################
############################################################################################################################################################################################################################################################################################

# R script created for:
# Tracking animations


############################################################################################################################################################################################################################################################################################
############################################################################################################################################################################################################################################################################################
############################################################################################################################################################################################################################################################################################


## First read in a range of relevant packages

library(tidyverse)
library(hms)
library(viridis)
library(sp)
require(sf)
library(gganimate)
library(gifski)
library(ggOceanMaps)
library(scico)

setwd("//saeri-file/users$/jriaz/Documents/Github/Bonus animation code/")


############################################################################################################################################################################################################################################################################################
############################################################################################################################################################################################################################################################################################
############################################################################################################################################################################################################################################################################################

## Read in data and basemap

SAFSData_SEA <- read_rds("SAFSData_dt.rds")

Basemap <- basemap(limits = c(-80, -37, -60, -32), bathy.style = "rcb" , rotate = TRUE, grid.col = NA) + 
   theme(legend.position = "none") +
   labs(y = "Longitude", x = "Latitude") +
   scale_fill_scico(palette= "devon", direction = -1, begin = 0.3, alpha = 0.5)
Basemap


############################################################################################################################################################################################################################################################################################
############################################################################################################################################################################################################################################################################################
###########################################################################################################################################################################################################################################################################################

## Configure so all animals leave their tagging location at the same time. Just for visual purposes


SAFSData_SEA$UniqueID <- paste(SAFSData_SEA$id, SAFSData_SEA$rep)

AniamtionData <- SAFSData_SEA %>%
 group_by(UniqueID) %>%
 arrange(UniqueID, date) %>% 
 mutate(sequential_column = row_number()) 


# Check <- AniamtionData %>%
#   group_by(UniqueID) %>%
#   summarise(max(sequential_column))


## Create the plot

Animation_Plot <- Basemap +
    ggspatial::geom_spatial_point(data = AniamtionData, aes(x = lon, y= lat, colour = UniqueID, group = UniqueID), size = 1) +
   labs(y = "Longitude", x = "Latitude", fill = "Jurisdiction") + 
   theme_bw(10) + 
  scale_colour_viridis_d(option = "H", begin = 0.7, end = 1) +
   theme(legend.position = "none") +
   transition_reveal(sequential_column, keep_last = FALSE)  +
   shadow_wake(wake_length = 0.05, alpha = 0.5)



# Save the animated the plot! :) 

gganimate::animate(Animation_Plot, duration = 20, fps = 10, height = 4.5, width = 7, units = "in", res = 300, renderer = av_renderer("Animation_plot.mp4"))
 











